let eventNames=require("gulp").eventNames;class PredictiveSearch extends HTMLElement{constructor(){super(),this.input=this.querySelector('input[type="search"]'),this.predictiveSearchResults=this.querySelector("[data-predictive-search]"),this.setupEventListeners()}setupEventListeners(){this.querySelector("form.search").addEventListener("submit",this.onFormSubmit.bind(this)),this.addEventListener("input",this.onInput.bind(this))}getQuery(){return this.input.value.trim()}async fetchSearchResults(t){if(t.length<2)this.predictiveSearchResults.innerHTML="";else try{var s=await(await fetch(`/search/suggest.json?q=${t}&resources[type]=product,variant`)).json(),r=(console.log("API Response:",s),s.resources.results.products||[]),i=s.resources.results.variants||[],n=(console.log("Products:",r),console.log("Variants:",i),r.map(e=>{var t=e.variants?.map(e=>({sku:e.sku||"N/A",inventory:e.inventory_quantity||"Unknown"})).filter(e=>""!==e.sku.trim())||[];return{title:e.title,url:e.url,image:e.image||"/default-image.jpg",skus:0<t.length?t.map(e=>e.sku).join(", "):"N/A",inventory:0<t.length?t.map(e=>e.inventory).join(", "):"Unknown",body_html:this.stripHtml(e.body_html||"")}})),a=i.map(e=>({title:e.product_title||"Variant",url:e.url,image:e.image||e.featured_image||"/default-image.jpg",skus:e.sku&&""!==e.sku.trim()?e.sku:e.inventory_item?.sku||"N/A",inventory:e.inventory_quantity||e.inventory_item?.inventory_quantity||"Unknown"}));let e=[...n,...a];e=e.filter(e=>e.skus.toLowerCase().includes(t.toLowerCase())),console.log("Formatted Results:",e),this.displaySearchResults(e)}catch(e){console.error("Error fetching predictive search results:",e)}}displaySearchResults(e){0===e.length?this.predictiveSearchResults.innerHTML="<p>No results found</p>":this.predictiveSearchResults.innerHTML=e.map(e=>`
                <div class="predictive-search-item">
                    <a href="${e.url}">
                        <img src="${e.image}" alt="${e.title}" />
                        <div>
                            <span class="title"><strong>${e.title}</strong></span>
                            <span class="sku">SKU(s): ${e.skus||"N/A"}</span>
                            <span class="inventory">Stock: ${e.inventory||"Unknown"}</span> 
                            <p class="description">${e.body_html.substring(0,80)}...</p>
                        </div>
                    </a>
                </div>
            `).join("")}stripHtml(e){return e.replace(/(<([^>]+)>)/gi,"")}onFormSubmit(e){var t;1<=this.getQuery().length&&(t=this.input.value.trim(),window.location.href="/search?q="+t),e.preventDefault()}onInput(e){"ArrowUp"!==e.code&&"ArrowDown"!==e.code||e.preventDefault(),13==e.keyCode?(e.preventDefault(),e=this.input.value.trim(),window.location.href="/search?q="+e):this.fetchSearchResults(this.getQuery())}}customElements.define("predictive-search",PredictiveSearch);