customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.querySelector("[name=id]").disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.submitButton=this.querySelector('[type="submit"]'),document.querySelector("cart-drawer")&&this.submitButton.setAttribute("aria-haspopup","dialog")}async onSubmitHandler(e){var a,t,r,s;e.preventDefault(),"true"!==this.submitButton.getAttribute("aria-disabled")&&(this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),this.querySelector(".loader").classList.remove("hidden"),(e=fetchConfig("javascript")).headers["X-Requested-With"]="XMLHttpRequest",delete e.headers["Content-Type"],a=new FormData(this.form),this.cart&&(a.append("sections",this.cart.getSectionsToRender().map(e=>e.id)),a.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),0<(t=await async function(){var r=document.querySelector('[name="default_shipping_address"]')?.value;if(0<r?.length){r=JSON.parse(r);a.append("properties[Shipping address]",`${r.firstName} ${r.lastName}, ${r.address1}, ${r.address2?r.address2+",":""} ${r.city}, ${r.province?r.province+",":""} ${r.country}, ${r.zip}, ${r.phone?r.phone+",":""} `+r.addressType);var s=Array.from(document.querySelectorAll("fieldset")).map(e=>{if(0<e.querySelectorAll("input").length)return Array.from(e.querySelectorAll("input")).find(e=>e.checked).value}),i=document.querySelector('[name="product_type"]')?.value,o=s[0];let e=1,t=1;switch(i){case"Cards":e=1,t=o.includes("Standard")?1:2;break;case"Gifts":e=2;break;case"Alcohol":e=3;break;default:e=1}s=[{product_type:e,product_size:t,product_quantity:1,address:{line:`${r.address1}, ${r.address2?r.address2+",":""} `+r.city,postcode:r.zip,country:countryToCode(r.country)},attached_products:[]}];return(await fetch("/apps/scribblerApi/v1/delivery-options",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)})).json()}}())?.length&&0<t[0]?.delivery_options?.length&&(r=new Date(t[0].delivery_options[0].deliverFrom),s=new Date(t[0].delivery_options[0].deliverTo),a.append("properties[_shipping_id]",t[0].delivery_options[0].delivery_id),a.append("properties[_shipping_name]",t[0].delivery_options[0].delivery_name),t[0].delivery_options[0].deliverFrom!==t[0].delivery_options[0].deliverTo&&a.append("properties[Delivery from]",`${r.getDate()}/${r.getMonth()+1}/`+r.getFullYear()),a.append("properties[Delivery to]",`${s.getDate()}/${s.getMonth()+1}/`+s.getFullYear())),e.body=a,fetch(""+routes.cart_add_url,e).then(e=>e.json()).then(e=>{var t;if(e.status)return this.handleErrorMessage(e.description),(t=this.submitButton.querySelector(".sold-out-message"))?(this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.querySelector("span").classList.add("hidden"),t.classList.remove("hidden"),void(this.error=!0)):void 0;this.cart?(this.stickyHeader=document.querySelector("sticky-header"),this.stickyHeader.reveal(),document.getElementById("added-to-basket-info").classList.add("open"),setTimeout(()=>{document.getElementById("added-to-basket-info").classList.remove("open")},6e3),this.error=!1,(t=this.closest("quick-add-modal"))?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cart.renderContents(e)})},{once:!0}),t.hide(!0)):this.cart.renderContents(e)):window.location=window.routes.cart_url}).catch(e=>{console.error(e)}).finally(()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||this.submitButton.removeAttribute("aria-disabled"),this.querySelector(".loader").classList.add("hidden")}))}handleErrorMessage(e=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!e),e)&&(this.errorMessage.textContent=e)}});